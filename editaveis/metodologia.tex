\chapter[Metodologia]{Metodologia}


Este capítulo foi elaborado para melhorar o entendimento das atividades
 realizadas para a produção deste trabalho. O fluxo da Figura 
\ref{fig:fases_metodologia} define estas atividades.

\begin{figure}[h]
    \centering
        \includegraphics[keepaspectratio=true,scale=0.7]{figuras/fases_metodologia.eps}
    \caption{Fluxo de Atividades para a resolução destes trabalho}
    \label{fig:fases_metodologia}
\end{figure}


\section{Revisão Bibliográfica}

A revisão bibliográfica foi a primeira atividade realizada para a construção
 deste trabalho. Foi feito um estudo e levantamento de métodos, técnicas e
 ferramentas que podem auxiliar o desenvolvimento deste trabalho, além de
 elucidar a viabilidade da realização do mesmo. Esta revisão foi utilizada
 como referência para a  escrita da fundamentação teórica.

\section{Seleção de Métodos}

Para seleção de métodos foi realizada uma priorização dos métodos, técnicas e
 ferramentas encontradas durante a revisão bibliográfica. A priorização levou
 em conta o esforço da implementação/execução dos métodos, o tempo para a
 montagem de caso e o recurso computacional necessário para a criação
 destes.

Os métodos selecionados foram:

\begin{itemize}
	\item \textit{Include Guards}, descrito na seção
 \ref{include_guards_section};
	\item \textit{Forward Declaration}, descrito na seção
 \ref{forward_declaration_section};
	\item Makefile, descrito na seção
 \ref{Makefile_section};
	\item Otimização de baixo nível descrito na seção
 \ref{Otimizacao_de_baixo_nivel};
	\item \textit{Pimpl Idiom} descrito na seção
 \ref{Pimpl_Idiom};
	\item Ferramentas de otimização descritas na seção
 \ref{ferramentas_de_otimizacao};
\end{itemize}

\section{Seleção de Projetos}

\subsection{Método de Seleção}

Para a seleção dos projetos foram analisadas 3 plataformas de controle de informação
de software livre: \textit{Openhub}, \textit{Github}, \textit{Gitlab}.

\textit{Openhub}, conhecido como Black Duck Open Hubi, é uma plataforma que busca dados através
 dos sistemas de versionamento (tais como CVS, Git ,Subversion,Bazaar e Mercurial),
 exibindo estatísticas sobre o histórico de um projeto e métricas do software.
 Esta plataforma não foi selecionada devido a possuir um sistema de busca baseada em tags,
 isso dificulta encontrar projetos específicos, pois o desenvolvedor que deve prover
 informações do projeto, e em alguns casos estas informações estão incoerentes e ou
 redundantes. Além deste não possuir um sistema de busca avançado.

\textit{Gitlab} é uma plataforma de gerenciamento de software, que permite os
 desenvolvedores criarem uma instância própria da ferramenta, para o armazenamento
 de um projeto de software em uma infraestrutura própria. Esta ferramenta foi
 descartada pois também possui sistema de tags para encontrar projetos de uma linguagem,
não permite selecionar múltiplas tags e não possui outro filtro de pesquisa avançada.

\textit{Github} é uma plataforma de gerenciamento de projetos de software que
utiliza o sistema de versionamento git. Esta plataforma foi selecionada devido a
 possibilidade de fazer pesquisa avançada utilizando tags, selecionar quantidade de forks,
 linguagem principal do projeto, conteúdo de texto dentro da descrição de um projeto e
 quantidade de estrelas dadas para um projeto.


A pesquisa avançada foi realizada no dia 27 de agosto de 2015, e foi utilizada
 com os seguintes critérios:

\begin{itemize}
    \item \textbf{Busca por palavra chave nas informações dos projetos}
        \subitem \textbf{mac os} - esta palavra foi selecionada para encontrar projetos
 que seja possível ser compilado em um sistema operacional da Apple. Este sistema tem
 como padrão o compilador clang e gcc/g++ como front-end  e como back-end possui o LLVM.
        \subitem \textbf{windows} - esta palavra foi selecionada para encontrar 
 que possui compatibilidade para instalar os compiladores gcc/g++.
\footnote{Para instalar um compilador é necessário utilizar uma ferramenta de criação de ambiente de desenvolvimento como \textit{cygwin}, \textit{mingw}, \textit{visual studio}, entre outros.}
        \subitem \textbf{linux} - esta palavra foi selecionada para encontrar projetos
 que seja possível compilar em um sistema operacional linux. Este vem por padrão com
 o compilador g++/gcc.
    \item \textbf{Linguagem}
        \subitem \textbf{language c++} - diretriz utilizada para restringir a busca de 
projetos que utilizam a linguagem c++ na maior parte de seu código.
    \item \textbf{Quantidade de Forks}
        \subitem \textbf{ > 10 forks} - diretriz para selecionar projetos com
 mais de 10 \textit{forks}.
    \item \textbf{Quantidade de Estrelas}
        \subitem \textbf{ < 10000 stars } - diretriz utilizada para projetos com menos
 de 10 mil estrelas, indicando que pelo menos 10 mil pessoas gostaram do projeto e este
é fortemente utilizado. 
\end{itemize}

Após esta pesquisa avançada foi selecionado os 5 primeiros projetos.


\begin{lstlisting}[language=python, caption={Busca avançada github },
                  label=busca_avanacada_github]
     linux windows mac os  language:C++  stars:<10 00 forks: > 10
\end{lstlisting}


\begin{figure}[h]
    \centering
        \includegraphics[scale=0.3]{figuras/github_search_1.eps}
    \caption{Pesquisa avançada Github parte 1}
    \label{pesquisa_github}
\end{figure}
\begin{figure}[h]
    \centering
        \includegraphics[scale=0.3]{figuras/github_search_2.eps}
    \caption{Pesquisa avançada Github parte 2}
    \label{pesquisa_github}
\end{figure}


\begin{table}[h]
\centering
\begin{tabular}{lllll}
\textbf{Projeto} & \textbf{Linguagem} & \textbf{Estrelas} & \textbf{Forks} & \textbf{Porcentagem em C++} \\ \toprule
Aseprite & C++ & 437  & 77  & 62.1\% \\ \midrule 
Pencil & C++ &  161 & 22  & 54.6\% \\ \midrule
Qcad & C++ & 110 & 51 & 80.8\% \\ \midrule 
Sudoku & C++ &  44  & 24 & 94.9\% \\ \midrule
iRecoveryplusplus & C++ & 17 & 11 & 84.7\%  \\ \bottomrule
\end{tabular} 
\caption{Projetos Selecionados}
\label{projetos_selecionados}
\end{table}


\subsection{Sobre os Projetos}

\begin{itemize}
    \item \textbf{Asepriter}
\footnote{\url{http://www.aseprite.org/}} é uma ferramenta para criação de sprites,
 compostas por camadas e quadros, suportadas em RGBA, paleta de 256 cores e escala de cinza.
 Permite visualizar a animação em tempo real e contém ferramentas para preencher contornos
 e polígonos. Esta ferramenta e open source e livre, e pode ser encontrada no \textit{github}
\footnote{\url{https://github.com/aseprite/aseprite}} ou no site da ferramenta
\footnote{\url{http://www.aseprite.org/}}.

    \begin{figure}[h]
        \centering
            \includegraphics[scale=0.3]{figuras/aseprite.eps}
        \caption{Imagem da ferramenta Aseprite}
        \label{ferramenta_aseprite}
    \end{figure}

    \item \textbf{}
\footnote{\url{http://www.pencil2d.org/pencil2d/}} é uma ferramenta para
 desenho e animação desenhada a mão, e utilizando desenhos em formato bitmap ou gráfico vetoriais. 
Esta ferramenta é gratuita  e open source, podendo ser encontrada em no \textit{github}
\footnote{\url{https://github.com/pencil2d/pencil}} ou no site da ferramenta
\footnote{\url{http://www.pencil2d.org}}.

    \begin{figure}[h]
        \centering
            \includegraphics[scale=0.3]{figuras/pencil2D.eps}
        \caption{Imagem da ferramenta }
        \label{ferramenta_pencil2D}
    \end{figure}

    \item \textbf{Qcad}
\footnote{\url{http://www.qcad.org/en/}} é um software para desenho
 assistido por computador em duas dimensões, permitindo a criação de desenhos técnicos como
 planos para edifícios, interiores, peças mecânicas ou esquemas e diagramas. Esta ferramenta
 e open source  e gratuita e podendo ser encontrada no \textit{github}
\footnote{\url{https://github.com/qcad/qcad}} ou no site da ferramenta.
\footnote{\url{http://www.qcad.org/en/}}

    \begin{figure}[h]
        \centering
            \includegraphics[scale=0.3]{figuras/qcad.eps}
        \caption{Imagem da ferramenta Qcad}
        \label{ferramenta_qcad}
    \end{figure}

    \item \textbf{Sudoku}
\footnote{\url{https://github.com/macartur-tcc/sudoku}} é um software que foi
 desenvolvido em um curso na universidade de Hasselt na Bélgica, esta foi escrita em c++ e utilizando Qt.
 Este é um software livre e liberado para domínio publico e pode ser encontrado apenas no \textit{github}
\footnote{\url{https://github.com/macartur-tcc/sudoku}}.

    \begin{figure}[h]
        \centering
            \includegraphics[scale=0.3]{figuras/sudoku.eps}
        \caption{Imagem da ferramenta Sudoku}
        \label{ferramenta_qcad}
    \end{figure}

    \item \textbf{iRecoveryplusplus}
\footnote{\url{https://github.com/GreySyntax/iRecoveryplusplus}} é um programa projetado para
 realizar comunicação de iPod, iPhone e iPad iBoot/iBSS  com interface USB. 
Este é um software livre e sobre a licença GPV v3 e pode ser encontrado no \textit{github}
\footnote{\url{https://github.com/GreySyntax/iRecoveryplusplus}} e é suportado em Linux, Mac OS e Windows.

\end{itemize}




\section{Ambiente}

\subsection{Ambiente Físico}

Para a realização dos estudos foi utilizado uma máquina com as
 especificações listada na tabela \ref{configuracoes_ambiente_fisico}

\begin{table}[h]
\centering
\begin{tabular}{lllll}
\textbf{Sistema Operacional} & \textit{Ubuntu} 14.04 \\ \toprule
\textbf{Kernel} & 3.19  \\ \midrule 
\textbf{Processador} & Intel i5 2.0Ghz \\ \midrule
\textbf{Memória Ram} & 4G  \\ \bottomrule 
\end{tabular} 
\caption{Configurações do Ambiente Físico}
\label{configuracoes_ambiente_fisico}
\end{table}


Nesta máquina foi instalado os programas:

\begin{itemize}
    \item \textbf{VirtualBox} - 4.0 : é uma ferramenta open source sobre a
 licença GPL v2 que permite a virtualização de máquinas.
    \item \textbf{Vagrant} - 1.7.4 : ferramenta de controle de
 máquina virtual possibilitando fácil acesso, criação, destruição, ligar e 
desligar máquinas virtuals.
    \item \textbf{Git} - 2.5.1 : ferramenta de controle de versão descentralizada
com o mesmo objetivo do \textit{SubVersion}(\textbf{SVN}).
\end{itemize}

\subsection{Ambiente Virtual}

\begin{itemize}

    \item \textbf{Linux}
        \subitem  O ambiente virtual Linux foi criado utilizando a box
 ubuntu/trusty64\footnote{\url{https://atlas.hashicorp.com/ubuntu/boxes/trusty64}},
 com a configuração do Vagrantfile no código \ref{vagrant_linux} e com especificações
 da máquina virtual mostradas na tabela \ref{especificacoes_linux}.
 Depois que construída a máquina virtual foram instalados os pacotes utilizando o
 gerenciador de pacotes apt, e estão listados na tabela \ref{pacotes_instalados_linux}.

Em ambiente linux o compilador padrão de C++ que vem instalado é o gcc/g++, este foi
 criado pela GNU e contém um conjunto de ferramentas para realizar, pré-processamento,
 compilação, montagem e link-edição. No front-end este compilador inclui as linguagens C,
 C++, Objective-C, Fortran, Java, Ada e Go, bem como bibliotecas
 (stdlibc++, libgcj, entre outras).


\begin{lstlisting}[language=ruby, caption={Vagrantfile com configurações da máquina virtual linux},
                  label=vagrant_linux]
    # Vagrantfile
    Vagrant.configure(2) do |config|
        config.vm.define 'linux' do |linux|
            linux.vm.box = "ubuntu/trusty64"
            linux.vm.network 'private_network', ip: "10.10.10.4"
            linux.vm.provider "virtualbox" do |vm| 
                vm.cpus = 2
                vm.memory = 2048
            end
        end              
    end
\end{lstlisting}

\begin{table}[h]
\centering
\begin{tabular}{ll}
\textbf{Sistema Operacional} & \textit{Ubuntu} 14.04 x86\_64 \\ \toprule
\textbf{Kernel} & 3.13.0-45-generic  \\ \midrule 
\textbf{Processador} & 2 processadores Virtuais \\ \midrule
\textbf{Memória Ram} & 2GB  \\ \bottomrule 
\end{tabular} 
\caption{Configurações do Ambiente Vitual Linux}
\label{especificacoes_linux}
\end{table}

\begin{table}[h]
\centering
\begin{tabular}{ll}
\textbf{Pacote} & \textbf{Versão} \\ \toprule
Qt5-default & 5.5.1 \\ \midrule 
Qt4-default & 4.8.7 \\ \midrule 
libusb-1.0-0/libusb-1.0-0-dev & 1.0.17-1ubuntu2 \\ \midrule 
libreadline6/libreadline6-dev & 6.3-4ubuntu2 amd6 \\ \midrule 
zlib1g/zlib1g-dev & 1.2.8.dfsg-1ubuntu1 amd6 \\ \midrule 
zlibc & 0.9k-4.1  \\ \midrule
g++/gcc  &  4:4.8.2-1ubuntu6 \\ \midrule 
git & 1.9.1-1 \\ \midrule 
cmake &   2.8.12.2  \\ \midrule 
ccache & 3.1.9  \\ \bottomrule 
\end{tabular} 
\caption{Pacotes instalados no Ambiente Virtual Linux}
\label{pacotes_instalados_linux}
\end{table}

    \item \textbf{Mac OS Yosemite}
        \subitem Para o ambiente Mac OS foi utilizada uma box com o sistema
 operacional na versão Yosemite 10.10.4
\footnote{\url{http://files.dryga.com/boxes/osx-yosemite-0.2.1.box}},
 com as configurações do Vagrantfile no código \ref{vagrant_mac_os_x} e com
 especificações da máquina virtual mostradas na tabela \ref{especificicacoes_mac_os_x}.
 Após a máquina criada foi necessário instalar os pacotes utilizando o gerenciador de
 pacotes brew, e foram listados os pacotes listados na tabela
\ref{pacotes_instalados_mac_os_x}.
Além dos listados foi necessário instalar o pacote "\textbf{MacOSX10.4.Universal.pkg}”
\footnote{\url{https://github.com/macartur-tcc/aseprite/blob/master/INSTALL.md}}
 disponibilizado pela Apple \footnote{\url{https://developer.apple.com/downloads/}}.

        \subitem Em um ambiente Mac OS o LLVM
\footnote{LLVM: infraestrutura de compilação utilizando o principio de modularização
 e reuso, propondo otimizar a compilação, execução e link-edição de programas
 escritos em linguagens variadas}é o back-end do compilador e como front-end
 padrão possui o clang/clang++, que foi projetado para ser 3 vezes mais rápido
 que o gcc/g++. As linguagens aceitas pelo clang são Objective-C, Fortran,
 Ada, Haskell, Java, Python, Ruby, ActionScript, GLSL, Julia, entre outras.


\begin{lstlisting}[language=ruby, caption={Vagrantfile com configurações da máquina virtual Mac OS Yosemite},
                  label=vagrant_mac_os_x]
    # Vagrantfile
    Vagrant.configure(2) do |config|
      config.vm.define 'mac_os_x' do |mac_os_x|
        mac_os_x.vm.box = "mac_os_x"
        mac_os_x.vm.network 'private_network', ip: "10.10.10.3"
        mac_os_x.vm.synced_folder "projetos", "/vagrant", type: "rsync"

        mac_os_x.vm.provider "virtualbox" do |vm|
          vm.gui = true
          vm.memory = 2024
        end
      end
    end

\end{lstlisting}

\begin{table}[h]
\centering
\begin{tabular}{ll}
\textbf{Sistema Operacional} & \textit{OS X Yosemite} x86\_64  \\ \toprule
\textbf{Kernel} & Darwin Kernel  14.4.0  \\ \midrule 
\textbf{Processador} & 2 processadores Virtuais \\ \midrule
\textbf{Memória Ram} & 2GB  \\ \bottomrule 
\end{tabular} 
\caption{Configurações do Ambiente Vitual Mac OS Yosemite}
\label{especificacoes_mac_os_x}
\end{table}


\begin{table}[h]
\centering
\begin{tabular}{ll}
\textbf{Pacote} & \textbf{Versão} \\ \toprule
qt5 & 5.5.1 \\ \midrule 
qt4 & 4.8.7 \\ \midrule 
libusb & 1.0.20 \\ \midrule 
readline & 6.3-8 \\ \midrule
zlib & 1.2.8 \\ \midrule
git & 1.9.1-1 \\ \midrule
cmake & 3.3.0  \\ \midrule
binutils & 2.25-4 \\ \midrule
ccache & 3.2.3 \\ \bottomrule
\end{tabular} 
\caption{Pacotes instalados no Ambiente Virtual Mac OS Yosemite}
\label{pacotes_instalados_mac_os_x}
\end{table}

    \item \textbf{Windows}
        \subitem Para o ambiente virtual Windows foi utilizado uma box com
 o sistema operacional Windows7\footnote{\url{https://vagrantcloud.com/datacastle/boxes/windows7}},
 com as configurações do Vagrantfile mostrada no código \ref{vagrant_windows},
 e com especificações da máquina virtual mostradas na tabela \ref{especificacoes_windows}.
 Para a utilização de um ambiente de desenvolvimento no windows é necessário a instalação
 do software \textit{cygwin}\footnote{\url{https://www.cygwin.com/}} que permite a instalação
o dos pacotes necessários para a criação do ambiente igual ao Unix.
 Utilizando o \textit{cygwin} é necessário instalar todos os pacotes para o sistema 
conseguir compilar programas em c++/c, para isto foram instalados os programas 
que se segue na tabela \ref{pacotes_instalados_windows}.

\begin{lstlisting}[language=ruby, caption={Vagrantfile com configurações da máquina virtual Windows 7},
                  label=vagrant_windows]
    #Vagrantfile
    Vagrant.configure(2) do |config|
      config.vm.define 'win7' do |win|
        win.vm.box = 'win7ie8'
        win.vm.network 'private_network', ip: '10.10.10.5'
        win.vm.provider 'virtualbox' do |vm|
              vm.cpus = 2
              vm.gui = true
              vm.memory = 1024
        end
      end
    end
\end{lstlisting}

\begin{table}[h]
\centering
\begin{tabular}{ll}
\textbf{Sistema Operacional} & \textit{Windows 7} x86\\ \toprule
\textbf{Kernel} & CYGWIN\_NT-6.1  \\ \midrule 
\textbf{Processador} & 2 processadores Virtuais \\ \midrule
\textbf{Memória Ram} & 2GB  \\ \bottomrule 
\end{tabular} 
\caption{Configurações do Ambiente Vitual Windows 7}
\label{especificacoes_windows}
\end{table}


\begin{table}[h]
\centering
\begin{tabular}{ll}
\textbf{Pacote} & \textbf{Versão} \\ \toprule
qt5-devel-tools  &  \\ 
qt5-translations & 5.5.1-1  \\ 
todos os pacotes que começam com este nome libQt5 & \\ \midrule

qt4-designer-plugin-webkit  & \\
qt4-devel-tools & 4.8.7-1 \\ 
qt4-qtconfig & \\ \midrule

libusb1.0 & 1.0.19-1 \\ \midrule


libreadline-devel & 6.3.8-1 \\ \midrule

zlib & 1.2.8 \\ \midrule
git & 2.5.3-1 \\ \midrule
ccache & 3.1.9-2 \\ \midrule
cmake & 3.3.2-1 \\ \midrule
cygwin-devel & 2.2.1 \\ \midrule
cygwin64-gcc-core & 4.9.2-1 \\ \midrule
gcc-core & \\ \midrule
gcc/g++ & 4.9.3-1 \\ 
make & 4.1-1 \\ \bottomrule
\end{tabular} 
\caption{Pacotes instalados no Ambiente Virtual Windows 7}
\label{pacotes_instalados_windows}
\end{table}

\end{itemize}



\section{Restrições de Compilação}

\subsection{Restrição Global}
    A utilização do linker gold não é possível compilar em todos os ambientes,
 pois é aplicada apenas a sistemas de arquivos binários ELF e nos ambientes
 Windows e Mac OS Yosemite os sistemas de arquivos são PE ou PE32+ e PEF 
respectivamente.

\subsection{Restrição Especifica}
    Em ambiente \textit{mingw} ou \textit{cygwin} não possui suporte
 a biblioteca glibc\footnote{
\url{https://www.gnu.org/software/gnulib/manual/html\_node/execinfo\_002eh.html}},
 isto fez com que o projeto Qcad que necessita do header exec\_info.h não possa ser compilado.

    Para alguns projetos foi necessário realizar modificações para a compilação
 dos mesmos nos diferentes sistemas operacionais,
estas alterações foram colocadas na branch master do repositório modificado,
utilizando um \textit{fork} do github
\footnote{\url{https://github.com/macartur-tcc/}} que contém todos os projetos.
 Esta restrição não impedindo a compilação dos projetos nos diferentes ambientes.

\section {Estudo de Caso}

\subsection{Aplicado ao Ambiente}

Os casos de guardas de inclusão foram realizados utilizando script de benchmark,
 na qual os métodos detalhados na seção \ref{include_guards_section} foram
 aplicados a 10 mil arquivos com uma pequena quantidade de código
 \ref{codigo_27} e incluidos 3 vezes ao arquivo \textbf{main.cpp} utilizando
 \ref{codigo_28}. Cada um destes foram aplicados aos diferentes ambientes de
 desenvolvimento.

\begin{lstlisting}[language=C++,caption={Template de arquivo .hpp utilizado no benchmark},
                                                   label=codigo_27]

  // <NUMERO>.hpp

  const int int<NUMERO> = <NUMERO>;

\end{lstlisting}

\begin{lstlisting}[language=C++,caption={Template de arquivo main.cpp utilizado no benchmark},
                                                          label=codigo_28]

    // main.cpp

    /* headers a serem incluidos   */

    ...

    int main(){return 0;}
\end{lstlisting}

Os scripts abordam os métodos:

\begin{itemize}
	\item guarda de Inclusão Externa;
	\item guarda de Inclusão Interna;
	\item \textit{pragma once};
	\item guarda de Inclusão Interna primeiro que \textit{pragma once};
	\item \textit{pragma once} primeiro que  Guarda de Inclusão Interna;
	\item guarda de Inclusão Externa + \textit{pragma once};
	\item redundância de Guarda de Inclusão.
\end{itemize}

\subsection{Aplicado a Projeto}

Antes da realização do estudo de caso foi necessário identificar quais
 as técnicas que poderiam ser aplicadas em cada um dos projetos.
 A tabela \ref{tecnicas_que_podem_ser_aplicadas} mostra esta analise em cada projeto.


\begin{table}[h]
\tiny
\begin{tabular}{p{2cm}p{2cm}p{2cm}p{2cm}p{2cm}p{2cm}p{2cm}p{2cm}}

\textbf{Projeto} & \multicolumn{7}{c}{técnicas que podem ser aplicadas} \\ 
 & \multicolumn{3}{c}{Alteração de Código} & \multicolumn{2}{c}{Alteração de Flags} & \multicolumn{2}{c}{ferramentas auxiliares}  \\ \toprule
& \textbf{pragma once} & \textbf{Forward Declaration} & \textbf{Pimpl Idiom} & \textbf{Makafile} &
 \textbf{Otimização de Baixo Nível} & \textbf{Ccache} & \textbf{Gold} \\ 
iRecoveryplusplus & SIM & SIM & SIM &  SIM & SIM & SIM & SIM \\ 
Sudoku &  SIM & SIM & SIM & SIM & SIM & SIM & SIM \\ 
Pencil & SIM & NÃO &  SIM & SIM & SIM & SIM & SIM \\ 
Aseprite &  SIM & NÃO & NÃO & SIM & SIM & SIM & SIM \\ 
Qcad &  SIM & NÃO & NÃO & SIM & SIM & SIM & SIM \\ \bottomrule
\end{tabular} 
\caption{Técnicas que podem ser aplicadas}
\label{tecnicas_que_podem_ser_aplicadas}
\end{table}

\subsubsection{Alteração de Código}

 Para as alterações de código, cada caso foi criado
 uma branch com suas modificações e estas estão no repositório
 destinado ao TCC\footnote{\url{https://github.com/macartur-tcc/}}.

    \begin{enumerate}
        \item Pragma Once
        \subitem Neste estudo de caso os arquivos de header foram alterados
 com a inclusão da diretiva “\#pragma once” no inicio de cada arquivo.
 No projeto aseprite está sendo removido a diretiva, pois todos os arquivos já possuem.
Estas alterações estão na branch “\textit{pragma\_once}” dos projetos que foi possível aplicar.
        \item Forward Declaration
        \subitem Neste estudo de caso os headers foram alterados para reduzir
 a quantidade de headers de todos os cabeçalhos e das implementação.
 Para isso foram removidos headers redundantes e que referenciava
 ponteiros e referências de endereço.
Estas alterações estão na branch "\textit{forward\_declaration}" dos projetos que foi possível aplicar.
        \item Técnicas de Pimpl Idiom
        \subitem Neste estudo de caso atributos e métodos privados foram removidos do cabeçalho
 e incluídos nos arquivos de implementação, como no exemplo de código \ref{exemplo_implementacao_pimpl}
 da seção \ref{Pimpl_Idiom}
 que demostra como aplicar a técnica.
Estas alterações estão na branch "\textit{pimpl}" dos projetos que foi possível aplicar.
    \end{enumerate}

\subsubsection{Alteração de flags de Compilação}

        \begin{enumerate}
            \item makefile
                \subitem Neste estudo de casos no momento da utilização do makefile
 será utilizado as flags: -j2,-j4,-j6,-j8 e -j10. Com este resultará na relação entre
a compilação e a quantidade de \textit{jobs}(\textit{threads}).
            \item Otimização de Baixo Nível
                \subitem Neste estudo de caso todos os arquivos Makefile serão
 alterados para receber a flags: -O, -O0, -O2, -Ofast, -O3, -Os,-Og.
 Com estes resultados será possível verificar a relação do tempo gasto com
 o tempo de otimização do compilador.
        \end{enumerate}

\subsubsection{Ferramentas Auxiliares}

        \begin{enumerate}
               \item CCache
                    \subitem Neste estudo de caso em cada projeto será adicionado
 a palavra ccache antes de cada linha de compilação. Será utilizado as
 configurações padrão do ccache, e antes de cada compilação para ter certeza
 que toda a cache será removida utilizará o comando ccache -C e ccache -c.
                \item Gold
                    \subitem Neste estudo de caso será ativado o ld.gold
 utilizando a flag:-Wl,-fuse-ld=gold como mostrado na seção \ref{Gold}. Assim  a
 compilação irá deixar de utilizar o linker padrão e utilizará o linker
 otimizado para sistema ELF.
        \end{enumerate}

\subsubsection{Passos de Compilação dos projetos}

\begin{itemize}
       \item {iRecoveryplusplus}
		\subitem Para compilar o projeto é necessário realizar o clone do projeto
 com o comando \ref{clonando_irecoveryplusplus}, e compilar o projeto
 segundo a tabela \ref{tecnicas_que_podem_ser_aplicadas}.
 Para remover os arquivos binários ou compilar utilizando o comando ccache
 ou gold deve-se utilizar a linha de comando da tabela \ref{t_compilacao_irecoveryplusplus}.

\begin{lstlisting}[language=bash, caption={Clonado Projeto iRecoveryplusplus},
                  label=clonando_irecoveryplusplus]
    $ git clone https://github.com/macartur-tcc/iRecoveryplusplus.git 
    $ cd iRecoveryplusplus
\end{lstlisting}


\begin{table}[h]
\begin{tabular}{p{2cm}p{2cm}p{2cm}p{2cm}}
\toprule
 & \multicolumn{3}{c}{Sistema Operacional} \\ \toprule 
\textbf{Atividade} & \textbf{Linux} & \textbf{Mac OS Yosemite} & \textbf{Windows 7}  \\ \midrule 
\textbf{compilar} & \multicolumn{3}{c}{make linux} \\ \midrule
\textbf{ccache} & \multicolumn{3}{c}{make linux CC="ccache gcc" CXX="ccache g++"} \\ \midrule
\textbf{gold} & \multicolumn{3}{c}{make linux  CC="gcc -Wl,-fuse-ld=gold" CXX="g++ -Wl,-fuse-ld=gold"} \\ \midrule
\textbf{remover binários} & \multicolumn{3}{c}{rm bin/*} \\ \bottomrule
\end{tabular} 
\caption{Comandos para compilação do projeto iRecoveryPlusPlus}
\label{t_compilacao_irecoveryplusplus}
\end{table}

    \item \textbf{Sudoku}
    \subitem Após realizar o clone do projeto do github
 \ref{clonando_sudoku} é necessário  gerar os Makefile,
 para isso utiliza-se o comando de geração de makefile na tabela .
Depois de gerado a compilação pode ser feita utilizando
 os comandos da tabela \ref{t_compilacao_sudoku}.

    
\begin{lstlisting}[language=bash, caption={Clonado Projeto iRecoveryplusplus},
                  label=clonando_sudoku]
    $ git clone https://github.com/macartur-tcc/sudoku.git 
    $ cd sudoku/src
\end{lstlisting}


\begin{table}[h]
\begin{tabular}{p{2cm}p{2cm}p{2cm}p{2cm}}
\toprule
 & \multicolumn{3}{c}{Sistema Operacional} \\ \toprule 
\textbf{Atividade} & \textbf{Linux} & \textbf{Mac OS Yosemite} & \textbf{Windows 7}  \\ \midrule 
\textbf{gerar makefile}
\footnote{Neste projeto e necessário remover a flag -archi386 do arquivo Makefile gerado na raiz, pois em sistemas Mac OS esta flag causa erro.}
 & \multicolumn{3}{c}{qmake Sudoku\_release.pro} \\ \midrule
\textbf{compilar} & \multicolumn{3}{c}{make } \\ \midrule
\textbf{ccache} & \multicolumn{3}{c}{make CC="ccache gcc" CXX="ccache g++"} \\ \midrule
\textbf{gold} & \multicolumn{3}{c}{make  CC="gcc -Wl,-fuse-ld=gold" CXX="g++ -Wl,-fuse-ld=gold"} \\ \midrule
\textbf{remover binários} & \multicolumn{3}{c}{make clean} \\ \bottomrule
\end{tabular} 
\caption{Comandos para compilação do projeto Sudoku}
\label{t_compilacao_sudoku}
\end{table}

    \item \textbf{Pencil}
    \subitem Após realizar o clone do projeto do github
\ref{clonando_pencil} é necessário  gerar os Makefile,
 para isso utiliza-se o comando de geração de makefile na tabela \ref{t_compilacao_pencil}.
Após a geração dos makefiles a tabela apresenta os comandos utilizados para compilar o projeto.

\begin{lstlisting}[language=bash, caption={Clonado Projeto Pencil},
                  label=clonando_pencil]
    $ git clone https://github.com/macartur-tcc/pencil.git
    $ cd pencil
\end{lstlisting}


\begin{table}[h]
\begin{tabular}{p{2cm}p{2cm}p{2cm}p{2cm}}
\toprule
 & \multicolumn{3}{c}{Sistema Operacional} \\ \toprule 
\textbf{Atividade} & \textbf{Linux} & \textbf{Mac OS Yosemite} & \textbf{Windows 7}  \\ \midrule 
\textbf{gerar makefile}
\footnote{Em ambiente Mac OS Yosemite é necessário passar o arquivo de traduções do projeto, este arquivo não é reconhecido automaticamente neste projeto.}
 & qmake -r & qmake -r RESOURCES=./pencil.qrc  & qmake -r \\ \midrule
\textbf{compilar} & \multicolumn{3}{c}{make } \\ \midrule
\textbf{ccache} & \multicolumn{3}{c}{make CC="ccache gcc" CXX="ccache g++"} \\ \midrule
\textbf{gold} & \multicolumn{3}{c}{make CC="gcc -Wl,-fuse-ld=gold" CXX="g++ -Wl,-fuse-ld=gold"} \\ \midrule
\textbf{remover binários} & \multicolumn{3}{c}{make clean} \\ \bottomrule
\end{tabular} 
\caption{Comandos para compilação do projeto Pencil}
\label{t_compilacao_pencil}
\end{table}

    \item \textbf{Aseprite}
    \subitem Após realizar o clone do projeto do github
\ref{clonando_aseprite} é necessário  gerar os Makefile,
 para isso utiliza-se o comando de geração de makefile na tabela 
\ref{t_compilacao_aseprite}.

\begin{lstlisting}[language=bash, caption={Clonado Projeto Aseprite e criando diretório de Compilação},
                  label=clonando_aseprite]
    $ git clone https://github.com/macartur-tcc/aseprite.git
    $ cd aseprite
    $ mkdir build
    $ cd build
\end{lstlisting}


\begin{table}[h]
\begin{tabular}{p{3cm}p{5cm}p{5cm}p{5cm}}
\toprule
 & \multicolumn{3}{c}{Sistema Operacional} \\ \toprule 
\textbf{Atividade} & \textbf{Linux} & \textbf{Mac OS Yosemite} & \textbf{Windows 7}  \\ \midrule 
\textbf{gerar makefile} 
\footnote{Para gerar o makefile em sistemas Mac OS é necessário utilizar as flags:
 -DCMAKE\_OSX\_ARCHITECTURES:STRING=i386  -DCMAKE\_OSX\_DEPLOYMENT\_TARGET:STRING=10.4  -DCMAKE\_OSX\_SYSROOT:STRING=/SDKs/MacOSX10.4u.sdk
\url{https://github.com/macartur-tcc/aseprite/blob/master/INSTALL.md}}
 &  \multicolumn{3}{c}{cmake .. -G "Unix Makefiles"} \\ \midrule
\textbf{compilar} & \multicolumn{3}{c}{make } \\ \midrule
\textbf{flags para gerar makefile com ccache} & -DCMAKE\_CXX\_COMPILER="ccache"  
-DCMAKE\_CXX\_COMPILER\_ARG1="g++" -DCMAKE\_C\_COMPILER="ccache" -DCMAKE\_C\_COMPILER\_ARG1="gcc"  \\ \midrule
\textbf{gerar makefile com gold} & 
CC="gcc  -Wl,-fuse-ld=gold" CXX="g++ -Wl,-fuse-ld=gold" cmake .. -G "Unix Makefiles" \\ \midrule
\textbf{remover binários} & \multicolumn{3}{c}{make clean} \\ \bottomrule
\end{tabular} 
\caption{Comandos para compilação do projeto Aseprite}
\label{t_compilacao_aseprite}
\end{table}


    \item \textbf{Qcad}
    \subitem Após realizar o clone do projeto do github\ref{clonando_qcad}
 é necessário  gerar os Makefile, para isso utiliza-se o comando de geração de
 makefile na tabela \ref{t_compilacao_qcad}. Depois de gerado a compilação pode ser feita
 utilizando os comandos da tabela \ref{t_compilacao_qcad}.


\begin{lstlisting}[language=bash, caption={Clonado Projeto Qcad},
                  label=clonando_qcad]
    $ git clone https://github.com/macartur-tcc/qcad.git
    $ cd qcad
\end{lstlisting}


\begin{table}[h]
\begin{tabular}{p{3cm}p{5cm}p{5cm}p{5cm}}
\toprule
 & \multicolumn{3}{c}{Sistema Operacional} \\ \toprule 
\textbf{Atividade} & \textbf{Linux} & \textbf{Mac OS Yosemite} & \textbf{Windows 7}  \\ \midrule 
\textbf{gerar makefile} & qmake -r & qmake -spec macx-g++ -r  
\footnote{Em ambiente Mac OS Yosemite este projeto não foi possível compilar
 utilizando o front-end clang, foi necessário utilizar o g++.} &  qmake -r  \\ \midrule
\textbf{compilar} & \multicolumn{3}{c}{make } \\ \midrule
\textbf{flags para gerar makefile com ccache} &  make CC="ccache gcc" CXX="ccache g++" \\ \midrule
\textbf{gerar makefile com gold} & make  CC="gcc -Wl,-fuse-ld=gold" CXX="g++ -Wl,-fuse-ld=gold" \\ \midrule
\textbf{remover binários} & \multicolumn{3}{c}{make clean} \\ \bottomrule
\end{tabular} 
\caption{Comandos para compilação do projeto Qcad}
\label{t_compilacao_qcad}
\end{table}

\end{itemize}


\section{Montagem de Scripts}


Os scripts foram elaborados utilizando a linguagem de programação python,
 e estão sendo armazenados no github
\footnote{\url{https://github.com/macartur-tcc/tcc_scripts}}.


\subsection{Aplicado ao Ambiente}\label{Amplicação ao Ambiente}

Para o estudo aplicado ao ambiente foi criado um script de benchmark utilizando
 a linguagem python, e foi detalhado no apêndice na seção Benchmark \ref{script_bench_mark}.

A Tabela \ref{tab:modelo_guards} representa o modelo utilizado na coleta dos dados,
 contendo Guarda de Inclusão Externa(GIE), Guarda de Inclusão Interna(GGI),
 Pragma Once(PO), Guarda de Inclusão Interna Primeiro que Pragma Once(GIIPPO),
 Pragma Once Primeiro que Guarda de Inclusão Interna (POPGII),
 Guarda de Inclusão Externa e Pragma Once (GIEPO) e
 Redundância de Guarda de Inclusão(RGI).

\begin{table}[!ht]
\centering
\caption{Template de amostra de Guardas de Inclusão}
\label{tab:modelo_guards}
\begin{tiny}
\begin{tabular}{lp{1cm}p{1cm}p{1cm}p{1cm}p{1cm}p{1cm}p{1cm}p{1cm}}

\textbf{Tipo} & \multicolumn{7}{l}{Utilização de Guarda de Inclusão} \\
\textbf{Medida} & \multicolumn{7}{l}{Tempos em segundos } \\
\textbf{Amostras} & \textbf{GIE} & \textbf{GII} & \textbf{PO} & 
\textbf{GIIPPO} & \textbf{POPGII} & \textbf{GIEPO} & \textbf{RGI} \\ \toprule
 1  &  &  &   &   &   &   &  \\ 
 2  &  &  &   &   &   &   &  \\ 
 3  &  &  &   &   &   &   &  \\ 
 4  &  &  &   &   &   &   &  \\ 
 5  &  &  &   &   &   &   &  \\ 
 6  &  &  &   &   &   &   &  \\ 
 7  &  &  &   &   &   &   &  \\ 
 8  &  &  &   &   &   &   &  \\ 
 9  &  &  &   &   &   &   &  \\ 
 10 &  &  &   &   &   &   &  \\ \bottomrule
 Média: & & & & &   &   &    \\ 
\end{tabular}
\end{tiny}
\end{table}


\subsection{Aplicado a Projeto}

Para realizar as compilações dos projetos foi criado um script de recompilação que
 segue no código \ref{script_recompilacoes}, com este é possível alterar entre
 branch para compilar as alterações de código dos projetos,
 executar comandos antes e depois de cada compilação.
 Para receber todos estes comandos foi necessário a leitura de um arquivo de
 configuração de cada projeto contendo a localização do projeto,
 localização do makefile, comandos que serão executados antes e depois
 da compilação.
 Este arquivo foi escrito em yaml e seguindo o template do código
 \ref{template_para_script_recompilacoes}.
Para a contagem do tempo de compilação foi utilizado o módulo datetime do python,
 realizando a diferença do tempo inicial e final do tempo de compilação.

Após a execução do script será preenchida as tabelas abaixo, e gerado gráficos para melhor
analisar os resultados. 


\begin{table}[!ht]
\centering
\caption{Modelo Alteração de Código}
\label{tab:modelo_alteracao_de_codigo}
\begin{tabular}{llll}
\textbf{<Nome do Projeto>} & \textbf{pragma once} & \textbf{forward declaration} & \textbf{private implementation}   \\ \toprule
1                                    &     &     &        \\ 
2                                    &     &     &        \\ 
3                                    &     &     &        \\ 
4                                    &     &     &        \\ 
5                                    &     &     &        \\ 
6                                    &     &     &        \\ 
7                                    &     &     &        \\ 
8                                    &     &     &        \\ 
9                                    &     &     &        \\ 
10                                   &     &     &        \\ \bottomrule
Média                                &     &     &        \\ 
\end{tabular}
\end{table}


\begin{table}[!ht]
\centering
\caption{Modelo Flags de Otimização da Compilação}
\label{tab:modelo_otimizacao_compilacao}
\begin{tabular}{llllllll}
\textbf{<Nome do Projeto>} & \textbf{-O} & \textbf{-O0} & \textbf{-O2} & \textbf{-O3} & \textbf{-Os} & \textbf{-Ofast} & \textbf{-Og} \\ \toprule
1                          &             &              &              &              &              &                 &        \\ 
2                          &             &              &              &              &              &                 &        \\ 
3                          &             &              &              &              &              &                 &        \\ 
4                          &             &              &              &              &              &                 &        \\ 
5                          &             &              &              &              &              &                 &        \\ 
6                          &             &              &              &              &              &                 &        \\ 
7                          &             &              &              &              &              &                 &        \\ 
8                          &             &              &              &              &              &                 &        \\ 
9                          &             &              &              &              &              &                 &        \\ 
10                         &             &              &              &              &              &                 &        \\ \bottomrule
Média                      &             &              &              &              &              &                 &        \\ 
\end{tabular}
\end{table}

\begin{table}[!ht]
\centering
\caption{Modelo Flags de Processamento Paralelo}
\label{tab:modelo_flag_processamento_paralelo}
\begin{tabular}{llllll}
\textbf{<Nome do Projeto>} & \textbf{-j 2} & \textbf{-j 4} & \textbf{-j 6} & \textbf{-j 8} & \textbf{-j10}  \\ \toprule
1                                    &    &     &     &     &        \\ 
2                                    &    &     &     &     &        \\ 
3                                    &    &     &     &     &        \\ 
4                                    &    &     &     &     &        \\ 
5                                    &    &     &     &     &        \\ 
6                                    &    &     &     &     &        \\ 
7                                    &    &     &     &     &        \\ 
8                                    &    &     &     &     &        \\ 
9                                    &    &     &     &     &        \\ 
10                                   &    &     &     &     &        \\ \bottomrule
Média                                &    &     &     &     &        \\ 
\end{tabular}
\end{table}

\begin{table}[!ht]
\centering
\caption{Modelo Ferramentas Auxiliares}
\label{tab:modelo_ferramentas_auxliares}
\begin{tabular}{lll}
\textbf{<Nome do Projeto>} & \textbf{gold} & \textbf{ccache}   \\ \toprule
1                                    &     &        \\ 
2                                    &     &        \\ 
3                                    &     &        \\ 
4                                    &     &        \\ 
5                                    &     &        \\ 
6                                    &     &        \\ 
7                                    &     &        \\ 
8                                    &     &        \\ 
9                                    &     &        \\ 
10                                   &     &        \\ \bottomrule
Média                                &     &        \\ 
\end{tabular}
\end{table}
